<html>
    <head>
        <meta charset="UTF-8">
        <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <script src="https://code.highcharts.com/stock/highstock.js"></script>
        <!--
        <script src="https://code.highcharts.com/modules/boost-canvas.js"></script>    
        <script src="https://code.highcharts.com/modules/boost.js"></script>    
        -->
        <script src="https://code.highcharts.com/stock/modules/data.js"></script>
        <script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.1/moment.min.js"></script>
        
        <style>
            #container {
            	min-width: 310px;
            	max-width: 1200px;
            	height: 600px;
            	margin: 0 auto;
            }
        </style>
    </head>
    <body>
        <div id="container"></div>
        
        <script>
            
            /*
                global Highcharts
                global moment
                global $
            */
            
            /*
            var csvurl = 'https://rues-test-jonasbieri.c9users.io/onlinedaten/roh/2018_bis_aktuell.csv';
            $.get(csvurl, function(data){
                console.log(data)
            });
            */
            Highcharts.stockChart('container', {
                data: {
                    csvURL: 'https://rues-test-jonasbieri.c9users.io/onlinedaten/roh/2018_bis_aktuell.csv',
                    enablePolling: false,
                    dataRefreshRate: 15*60,
                    //dateFormat: 'DD.MM.YYYY HH:mm:ss',
                    parseDate: function(v, a, b){
                        //var date = moment(v, 'DD.MM.YYYY HH:mm:ss').toDate();
                        var date = moment(v, 'DD.MM.YYYY HH:mm:ss').utc().valueOf();
                        return date;
                    },
                    parsed: function(columns){
                        //remove second datetime column
                        columns.splice(1, 1);
                        //find wrong ordering
                        for (var i=1; i<columns[0].length-1; i++){
                            //console.log(columns[i+1]);
                            if (columns[0][i+1] - columns[0][i] < 0){
                                console.log('wrong sort in line ', i-1, columns[0][i], columns[0][i+1] );
                            }
                        }
                        //rename series
                        columns[1][0] = 'Elektrische Leitfähigkeit';
                        columns[2][0] = 'Sauerstoffgehalt';
                        columns[3][0] = 'pH';
                        columns[4][0] = 'Temperatur';
                    },
                    complete: function(obj){
                        //sort
                        /*
                        obj.series[0].data.sort(function(a, b){
                            return a-b;
                        })
                        */
                    },
                    seriesMapping: [
                        {x: 0, y: 1},
                        {x: 0, y: 2},
                        {x: 0, y: 3},
                        {x: 0, y: 4},
                    ]
                },
                xAxis: {
                    type: "datetime",
                },
                yAxis: [
                    {
                        title: {
                            text: 'Temperatur', 
                        },
                        height: '25%',
                        //opposite: false,
                        offset: 0
                    },
                    {   
                        title: {
                            text: "pH", 
                        },
                        height: '25%',
                        top: '25%',
                        //opposite: false,
                        offset: 0
                    },
                    {
                        title: {
                            text: "Sauerstoffgehalt", 
                        },
                        height: '25%',
                        top: '50%', 
                        //opposite: false,
                        offset: 0
                    },
                    {   
                        title: {
                            text: "Elektrische Leitfähigkeit", 
                        },
                        height: '25%',
                        top: '75%',
                        //opposite: false,
                        offset: 0
                    }
                    ],
                series: [
                    {
                        yAxis: 3, 
                    },
                    {
                        yAxis: 2, 
                    },
                    {
                        yAxis: 1,
                    },
                    {
                        yAxis: 0,
                    }
                    ], 
                rangeSelector: {
                    selected: 5
                },
                plotOptions: {
                    line: {
                        tooltip: {
                            valueDecimals: 2
                        }
                    }
                },
                navigator: {
                    enabled: false
                }, 
            });            
        </script>
    </body>
</html>